<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <title>OMNI-OS FINAL</title>
    <style>
        /* 
         * ──────────────────────────────────────────────────────────────────────────
         *  CORE SYSTEM - FIXED LAYOUT ENGINE
         * ──────────────────────────────────────────────────────────────────────────
         */
        :root {
            --bg-app: #000000;
            --bg-panel: #121212;
            --bg-btn: #1E1E1E;
            --bg-btn-active: #2C2C2C;
            
            --accent: #0A84FF;
            --accent-rgb: 10, 132, 255;
            --op-color: #FF9F0A;
            --danger: #FF453A;
            --text-main: #FFFFFF;
            --text-sec: #8E8E93;
            
            --nav-height: 60px;
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; outline: none; }
        
        body {
            margin: 0; padding: 0;
            background: var(--bg-app);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
            /* CRITICAL FIX: Use dvh to avoid browser bar overlap */
            height: 100vh; height: 100dvh;
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* 
         * ──────────────────────────────────────────────────────────────────────────
         *  MAIN VIEWPORT (FLEXBOX)
         * ──────────────────────────────────────────────────────────────────────────
         */
        #viewport {
            flex: 1; /* Takes all available space */
            position: relative;
            overflow: hidden;
            display: flex; flex-direction: column;
        }

        .page {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-app);
            display: flex; flex-direction: column;
            transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            z-index: 10;
        }
        .page.active { transform: translateX(0); z-index: 20; }

        /* HEADER */
        .header {
            flex: 0 0 50px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px;
            font-weight: 700; letter-spacing: 0.5px;
            background: rgba(18,18,18,0.95);
            border-bottom: 1px solid #333;
        }

        /* SCROLLABLE CONTENT AREA */
        .content { flex: 1; overflow-y: auto; padding: 20px; }

        /* 
         * ──────────────────────────────────────────────────────────────────────────
         *  BOTTOM NAVIGATION (FIXED)
         * ──────────────────────────────────────────────────────────────────────────
         */
        #navbar {
            flex: 0 0 calc(var(--nav-height) + var(--safe-bottom));
            background: #090909;
            border-top: 1px solid #333;
            display: grid; grid-template-columns: repeat(5, 1fr);
            padding-bottom: var(--safe-bottom);
            z-index: 100;
        }

        .nav-btn {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #666; font-size: 10px; border: none; background: transparent;
        }
        .nav-btn.active { color: var(--accent); }
        .nav-icon { font-size: 20px; margin-bottom: 4px; }

        /* 
         * ──────────────────────────────────────────────────────────────────────────
         *  CALCULATOR PAGE (FLEX LAYOUT)
         * ──────────────────────────────────────────────────────────────────────────
         */
        #calc-display {
            flex: 0 0 35%; /* Top 35% of screen */
            display: flex; flex-direction: column; justify-content: flex-end; align-items: flex-end;
            padding: 20px;
        }
        
        #history-line { color: var(--text-sec); font-size: 1.2rem; min-height: 1.5rem; margin-bottom: 5px; font-family: 'Courier New', monospace; }
        #result-line { 
            font-size: 4rem; font-weight: 300; color: #fff; width: 100%; 
            text-align: right; background: transparent; border: none; 
        }

        #calc-keypad {
            flex: 1; /* Takes remaining space */
            background: var(--bg-panel);
            border-top-left-radius: 24px; border-top-right-radius: 24px;
            padding: 15px;
            padding-bottom: 15px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(5, 1fr); /* 5 Equal Rows */
            gap: 12px;
        }

        .key {
            background: var(--bg-btn); color: #fff;
            border: none; border-radius: 14px;
            font-size: 1.5rem; font-weight: 500;
            display: flex; align-items: center; justify-content: center;
            transition: 0.1s;
        }
        .key:active { background: var(--bg-btn-active); transform: scale(0.95); }
        .key.op { background: var(--op-color); color: #000; font-weight: 600; }
        .key.fn { background: #333; font-size: 1.1rem; }
        .key.ac { background: #A0A0A0; color: #000; }
        
        /* Scientific Overlay */
        #sci-pad {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 60%;
            background: rgba(20,20,20,0.98);
            backdrop-filter: blur(20px);
            border-top-left-radius: 24px; border-top-right-radius: 24px;
            padding: 20px;
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;
            transform: translateY(110%); transition: transform 0.3s;
            z-index: 50;
        }
        #sci-pad.visible { transform: translateY(0); }

        /* 
         * ──────────────────────────────────────────────────────────────────────────
         *  TOOLS & WIDGETS
         * ──────────────────────────────────────────────────────────────────────────
         */
        .card { background: var(--bg-panel); padding: 15px; border-radius: 16px; margin-bottom: 15px; }
        .card h3 { margin: 0 0 10px 0; color: var(--text-sec); font-size: 0.8rem; text-transform: uppercase; }
        .row { display: flex; gap: 10px; margin-bottom: 10px; }
        
        input, select, textarea {
            width: 100%; background: #222; border: none; padding: 12px; 
            border-radius: 8px; color: #fff; font-size: 1rem;
        }

        /* History Items */
        .log-item {
            padding: 15px; border-bottom: 1px solid #333;
            display: flex; justify-content: space-between;
        }
        .log-eq { color: var(--text-sec); }
        .log-res { color: var(--accent); font-weight: bold; }

    </style>
</head>
<body>

    <!-- ─── VIEWPORT ──────────────────────────────────────────────── -->
    <div id="viewport">
        
        <!-- 1. CALCULATOR (Main) -->
        <div id="page-calc" class="page active">
            <div id="calc-display">
                <div style="width:100%; display:flex; justify-content:space-between;">
                    <span id="mode-indicator" style="font-size:0.8rem; color:var(--accent)">RAD</span>
                    <span onclick="App.toggleSci()" style="font-size:1.2rem; color:var(--text-sec); cursor:pointer">⋮</span>
                </div>
                <div id="history-line"></div>
                <input type="text" id="result-line" value="0" readonly>
            </div>
            
            <div id="calc-keypad">
                <button class="key ac" onclick="Calc.input('AC', 'ac')">AC</button>
                <button class="key ac" onclick="Calc.input('DEL', 'del')">⌫</button>
                <button class="key ac" onclick="Calc.input('%', 'op')">%</button>
                <button class="key op" onclick="Calc.input('/', 'op')">÷</button>
                
                <button class="key" onclick="Calc.input('7')">7</button>
                <button class="key" onclick="Calc.input('8')">8</button>
                <button class="key" onclick="Calc.input('9')">9</button>
                <button class="key op" onclick="Calc.input('*', 'op')">×</button>
                
                <button class="key" onclick="Calc.input('4')">4</button>
                <button class="key" onclick="Calc.input('5')">5</button>
                <button class="key" onclick="Calc.input('6')">6</button>
                <button class="key op" onclick="Calc.input('-', 'op')">−</button>
                
                <button class="key" onclick="Calc.input('1')">1</button>
                <button class="key" onclick="Calc.input('2')">2</button>
                <button class="key" onclick="Calc.input('3')">3</button>
                <button class="key op" onclick="Calc.input('+', 'op')">+</button>
                
                <button class="key fn" onclick="App.toggleSci()">SCI</button>
                <button class="key" onclick="Calc.input('0')">0</button>
                <button class="key" onclick="Calc.input('.')">.</button>
                <button class="key op" style="background:var(--accent); color:#fff" onclick="Calc.solve()">=</button>
            </div>

            <!-- Scientific Drawer -->
            <div id="sci-pad">
                <div style="grid-column:span 4; display:flex; justify-content:space-between; margin-bottom:10px; border-bottom:1px solid #333; padding-bottom:10px;">
                    <span style="font-weight:bold">Advanced Functions</span>
                    <span onclick="App.toggleSci()" style="color:var(--danger); cursor:pointer">Close</span>
                </div>
                <button class="key fn" onclick="Calc.input('sin(', 'fn')">sin</button>
                <button class="key fn" onclick="Calc.input('cos(', 'fn')">cos</button>
                <button class="key fn" onclick="Calc.input('tan(', 'fn')">tan</button>
                <button class="key fn" onclick="Calc.toggleMode()">DEG</button>
                
                <button class="key fn" onclick="Calc.input('log(', 'fn')">log</button>
                <button class="key fn" onclick="Calc.input('ln(', 'fn')">ln</button>
                <button class="key fn" onclick="Calc.input('^', 'op')">^</button>
                <button class="key fn" onclick="Calc.input('sqrt(', 'fn')">√</button>
                
                <button class="key fn" onclick="Calc.input('(', 'fn')">(</button>
                <button class="key fn" onclick="Calc.input(')', 'fn')">)</button>
                <button class="key fn" onclick="Calc.input('pi', 'const')">π</button>
                <button class="key fn" onclick="Calc.input('e', 'const')">e</button>

                <button class="key fn" onclick="Calc.input('inv(', 'fn')">1/x</button>
                <button class="key fn" onclick="Calc.input('fact(', 'fn')">x!</button>
                <button class="key fn" onclick="Calc.input('abs(', 'fn')">|x|</button>
                <button class="key fn" onclick="Calc.input('rnd', 'const')">RND</button>
            </div>
        </div>

        <!-- 2. PROGRAMMER (New) -->
        <div id="page-prog" class="page">
            <div class="header">
                <span>Programmer</span>
                <button onclick="Calc.input('AC','ac');App.updateProg(0)" style="background:none;border:none;color:var(--danger)">CLR</button>
            </div>
            <div class="content">
                <div class="card" style="text-align:right; font-family:monospace;">
                    <div style="color:#888; font-size:0.8rem">HEX</div>
                    <div id="prog-hex" style="font-size:1.2rem; margin-bottom:5px">0</div>
                    <div style="color:#888; font-size:0.8rem">DEC</div>
                    <div id="prog-dec" style="font-size:1.2rem; color:var(--accent); margin-bottom:5px">0</div>
                    <div style="color:#888; font-size:0.8rem">BIN</div>
                    <div id="prog-bin" style="font-size:1.2rem; word-break:break-all">0</div>
                </div>
                <div style="display:grid; grid-template-columns:repeat(4,1fr); gap:8px;">
                    <button class="key fn" onclick="App.progInput('A')">A</button>
                    <button class="key fn" onclick="App.progInput('B')">B</button>
                    <button class="key fn" onclick="App.progInput('C')">C</button>
                    <button class="key fn" onclick="App.progInput('D')">D</button>
                    <button class="key fn" onclick="App.progInput('E')">E</button>
                    <button class="key fn" onclick="App.progInput('F')">F</button>
                    <button class="key fn" onclick="App.progInput('<<')">«</button>
                    <button class="key fn" onclick="App.progInput('>>')">»</button>
                </div>
                <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-top:10px;">
                    <button class="key" onclick="App.progInput('7')">7</button><button class="key" onclick="App.progInput('8')">8</button><button class="key" onclick="App.progInput('9')">9</button>
                    <button class="key" onclick="App.progInput('4')">4</button><button class="key" onclick="App.progInput('5')">5</button><button class="key" onclick="App.progInput('6')">6</button>
                    <button class="key" onclick="App.progInput('1')">1</button><button class="key" onclick="App.progInput('2')">2</button><button class="key" onclick="App.progInput('3')">3</button>
                    <button class="key" style="grid-column:span 3" onclick="App.progInput('0')">0</button>
                </div>
            </div>
        </div>

        <!-- 3. TOOLS -->
        <div id="page-tools" class="page">
            <div class="header">Tools</div>
            <div class="content">
                <!-- Unit Converter -->
                <div class="card">
                    <h3>Unit Converter</h3>
                    <div class="row">
                        <select id="conv-type" onchange="Tools.updateUI()">
                            <option value="len">Length</option><option value="mass">Mass</option><option value="data">Data</option>
                        </select>
                    </div>
                    <div class="row">
                        <input type="number" id="conv-in" value="1" oninput="Tools.convert()">
                        <select id="conv-from" onchange="Tools.convert()"></select>
                    </div>
                    <div class="row">
                        <input type="text" id="conv-out" readonly>
                        <select id="conv-to" onchange="Tools.convert()"></select>
                    </div>
                </div>
                
                <!-- Notepad (New) -->
                <div class="card">
                    <h3>Scratchpad</h3>
                    <textarea id="notepad" rows="5" placeholder="Type notes here..." oninput="localStorage.setItem('omni_notes', this.value)"></textarea>
                </div>
            </div>
        </div>

        <!-- 4. LOGS -->
        <div id="page-log" class="page">
            <div class="header">
                <span>History Log</span>
                <button onclick="Calc.clearHistory()" style="background:none; border:none; color:var(--danger)">Clear</button>
            </div>
            <div class="content" id="log-list">
                <!-- Logs go here -->
            </div>
        </div>

        <!-- 5. SETUP -->
        <div id="page-setup" class="page">
            <div class="header">Settings</div>
            <div class="content">
                <div class="card">
                    <div class="row" style="justify-content:space-between; align-items:center">
                        <span>Haptic Feedback</span>
                        <span style="color:var(--accent)">ON</span>
                    </div>
                    <hr style="border:0; border-top:1px solid #333">
                    <div class="row" style="justify-content:space-between; align-items:center">
                        <span>Version</span>
                        <span style="color:#666">11.0.0 (Final)</span>
                    </div>
                    <hr style="border:0; border-top:1px solid #333">
                    <button onclick="localStorage.clear();location.reload()" style="width:100%; padding:15px; background:var(--danger); color:white; border:none; border-radius:8px; margin-top:10px;">Factory Reset</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ─── NAVIGATION ──────────────────────────────────────────────── -->
    <nav id="navbar">
        <button class="nav-btn active" onclick="App.nav('calc', this)">
            <span class="nav-icon">﹢</span><span>Calc</span>
        </button>
        <button class="nav-btn" onclick="App.nav('prog', this)">
            <span class="nav-icon">_></span><span>Dev</span>
        </button>
        <button class="nav-btn" onclick="App.nav('tools', this)">
            <span class="nav-icon">⚃</span><span>Tools</span>
        </button>
        <button class="nav-btn" onclick="App.nav('log', this)">
            <span class="nav-icon">≡</span><span>Log</span>
        </button>
        <button class="nav-btn" onclick="App.nav('setup', this)">
            <span class="nav-icon">⚙</span><span>Setup</span>
        </button>
    </nav>

<script>
/* CORE ENGINE */
const App = {
    init: () => {
        // Load Notes
        if(localStorage.getItem('omni_notes')) document.getElementById('notepad').value = localStorage.getItem('omni_notes');
        // Load History
        Calc.renderHistory();
        // Init Tools
        Tools.updateUI();
    },

    nav: (id, btn) => {
        // Switch Page
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(`page-${id}`).classList.add('active');
        
        // Switch Tab
        if(btn) {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }
    },

    toggleSci: () => document.getElementById('sci-pad').classList.toggle('visible'),

    // Programmer Mode Logic
    progVal: 0,
    progInput: (v) => {
        let current = document.getElementById('prog-hex').innerText;
        if(v === '<<') App.progVal = App.progVal << 1;
        else if(v === '>>') App.progVal = App.progVal >> 1;
        else {
            // Append hex digit
            const next = parseInt(current + v, 16);
            if(!isNaN(next)) App.progVal = next;
        }
        App.updateProg(App.progVal);
    },
    updateProg: (val) => {
        App.progVal = val;
        document.getElementById('prog-hex').innerText = val.toString(16).toUpperCase();
        document.getElementById('prog-dec').innerText = val.toString(10);
        document.getElementById('prog-bin').innerText = val.toString(2);
    }
};

const Calc = {
    inputStr: '0',
    angle: 'rad',
    history: JSON.parse(localStorage.getItem('omni_hist') || '[]'),

    input: (val, type) => {
        if(navigator.vibrate) navigator.vibrate(5);
        
        if(type === 'ac') {
            Calc.inputStr = '0';
            document.getElementById('history-line').innerText = '';
        } else if (type === 'del') {
            Calc.inputStr = Calc.inputStr.length > 1 ? Calc.inputStr.slice(0,-1) : '0';
        } else {
            if(Calc.inputStr === '0' && val !== '.') Calc.inputStr = val;
            else Calc.inputStr += val;
        }
        Calc.update();
    },

    toggleMode: () => {
        Calc.angle = Calc.angle === 'rad' ? 'deg' : 'rad';
        document.getElementById('mode-indicator').innerText = Calc.angle.toUpperCase();
    },

    solve: () => {
        try {
            const raw = Calc.inputStr;
            let expr = raw.replace(/pi/g, 'Math.PI').replace(/e/g, 'Math.E').replace(/sqrt/g, 'Math.sqrt');
            expr = expr.replace(/\^/g, '**');
            
            // Trig handling
            if(Calc.angle === 'deg') {
                expr = expr.replace(/sin\(([^)]+)\)/g, 'Math.sin($1*Math.PI/180)');
                expr = expr.replace(/cos\(([^)]+)\)/g, 'Math.cos($1*Math.PI/180)');
                expr = expr.replace(/tan\(([^)]+)\)/g, 'Math.tan($1*Math.PI/180)');
            } else {
                expr = expr.replace(/sin/g, 'Math.sin').replace(/cos/g, 'Math.cos').replace(/tan/g, 'Math.tan');
            }

            expr = expr.replace(/log/g, 'Math.log10').replace(/ln/g, 'Math.log');
            
            // Eval safely
            const res = Function('"use strict";return (' + expr + ')')();
            
            const out = parseFloat(res.toPrecision(12)).toString();
            Calc.inputStr = out;
            Calc.history.unshift({eq: raw, res: out});
            localStorage.setItem('omni_hist', JSON.stringify(Calc.history));
            Calc.renderHistory();
            
            document.getElementById('history-line').innerText = raw + ' =';
        } catch(e) {
            Calc.inputStr = 'Error';
        }
        Calc.update();
    },

    update: () => document.getElementById('result-line').value = Calc.inputStr,

    renderHistory: () => {
        const h = document.getElementById('log-list');
        h.innerHTML = Calc.history.map(item => `
            <div class="log-item" onclick="Calc.inputStr='${item.res}';Calc.update();App.nav('calc')">
                <span class="log-eq">${item.eq}</span>
                <span class="log-res">= ${item.res}</span>
            </div>
        `).join('');
    },

    clearHistory: () => {
        Calc.history = [];
        localStorage.removeItem('omni_hist');
        Calc.renderHistory();
    }
};

const Tools = {
    data: {
        len: { m:1, km:0.001, ft:3.2808 },
        mass: { kg:1, lb:2.2046 },
        data: { mb:1, gb:0.00097, kb:1024 }
    },
    updateUI: () => {
        const type = document.getElementById('conv-type').value;
        const opts = Object.keys(Tools.data[type]).map(k => `<option value="${k}">${k.toUpperCase()}</option>`).join('');
        document.getElementById('conv-from').innerHTML = opts;
        document.getElementById('conv-to').innerHTML = opts;
    },
    convert: () => {
        const type = document.getElementById('conv-type').value;
        const val = parseFloat(document.getElementById('conv-in').value);
        const f = document.getElementById('conv-from').value;
        const t = document.getElementById('conv-to').value;
        if(isNaN(val)) return;
        
        const ratio = Tools.data[type];
        const res = (val / ratio[f]) * ratio[t];
        document.getElementById('conv-out').value = res.toPrecision(6);
    }
};

window.onload = App.init;
</script>
</body>
</html>